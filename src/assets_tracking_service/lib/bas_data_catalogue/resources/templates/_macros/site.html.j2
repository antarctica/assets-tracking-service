{% import '_macros/common.html.j2' as com %}

{% macro html_head(title) %}
  <head>
    {{ head_meta() }}
    {{ head_title(title) }}
    {{ head_styles() }}
    {{ head_scripts() }}
  </head>
{% endmacro %}

{% macro head_meta(value) %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
{% endmacro %}

{% macro head_title(value) %}
  <title>{{ value }}</title>
{% endmacro %}

{% macro head_styles() %}
  <link rel="stylesheet" href="https://cdn.web.bas.ac.uk/libs/font-awesome-pro/5.13.0/css/all.min.css" integrity="sha256-DjbUjEiuM4tczO997cVF1zbf91BC9OzycscGGk/ZKks=" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/main.css" />
{% endmacro %}

{% macro head_scripts(data) %}
  {{ script_sentry() }}
  {{ script_sticky_tabs() }}
  {{ script_collapsible() }}
{% endmacro %}

{% macro script_sentry() %}
  <script>
    window.sentryOnLoad = function() {
      Sentry.init({
        tracesSampleRate: 0,
        replaysSessionSampleRate: 0,
        replaysOnErrorSampleRate: 0,
      });
      Sentry.lazyLoadIntegration("feedbackIntegration").then(
        (integration) => {
          Sentry.addIntegration(integration({
            autoInject: false,
            showBranding: false,
            colorScheme: "light",
            formTitle: "Send Feedback",
            submitButtonLabel: "Send Feedback",
            messagePlaceholder: "",
            successMessageText: "Thank you for your feedback.",
          }));

          const feedback = Sentry.getFeedback();
          if (feedback) {
            const triggers = document.querySelectorAll(".{{ com.sentry_trigger() }}");
            triggers.forEach(trigger => {
              feedback.attachTo(trigger, {});
            });
          }
        }
      );
    };
  </script>
  <script src="https://js.sentry-cdn.com/57698b6483c7ac43b7c9c905cdb79943.min.js" crossorigin="anonymous"></script>
{% endmacro %}

{% macro script_sticky_tabs() %}
  <script>
    /* Based on jQuery Plugin Sticky Tabs by Aidan Lister <aidan@php.net> */
    (function () {
      const selectTab = (tabId) => {
        const input = document.getElementById(tabId);
        if (input && input.type === "radio") {
          input.checked = true;
          window.history.pushState(null, null, `#${tabId}`);
        }
      };

      document.addEventListener("DOMContentLoaded", function () {
        const hash = window.location.hash;
        if (hash) {
          selectTab(hash.substring(1)); // Remove '#' from hash
        }

        const tabLabels = document.querySelectorAll('label[for^="tab-"]');
        tabLabels.forEach((label) => {
          label.addEventListener("click", () => {
            const tabId = label.getAttribute("for");
            selectTab(tabId);
          });
        });
      });
    })();
  </script>
{% endmacro %}

{% macro script_collapsible() %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Find all elements with the `data-target` attribute and add click event listeners to hide/show a target element
      const toggles = document.querySelectorAll('[data-target]');

      toggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
          const targetSelector = toggle.getAttribute('data-target');
          const targetElement = document.querySelector(targetSelector);
          if (targetElement) {
            targetElement.classList.toggle('hidden');
          }
        });
      });
    });
  </script>
{% endmacro %}

{% macro top_anchor() %}
  <div id="{{ com.back_to_top_id() }}"></div>
{% endmacro %}

{% macro header() %}
  <header id="site-header" class="space-y-4">
    {{ navbar() }}
    {{ dev_phase() }}
  </header>
{% endmacro %}

{% macro navbar() %}
  <nav id="site-nav" class="bg-grey-950 text-white">
    <div class="{{ com.container_classes() }} py-4">
      <div class="flex items-center justify-between">
        <a id="site-title" class="font-bold text-lg" href="/">BAS Data Catalogue</a>
      </div>
    </div>
  </nav>
{% endmacro %}

{% macro dev_phase() %}
  <div id="site-dev" class="{{ com.container_classes() }} space-x-2">
    <span id="site-dev-phase" class="uppercase text-sm font-bold bg-pink-500 text-white px-2">alpha</span>
    <span>
      This is a new website, your
      <button class="{{ com.sentry_trigger() }} {{ com.link_classes() }}">feedback</button> will help us to improve it.
    </span>
  </div>
{% endmacro %}

{% macro footer(current_year) %}
  <footer id="site-footer" class="font-light bg-grey-950 text-grey-100">
    <div class="{{ com.container_classes() }} py-8 space-y-8">
      <div class="flex justify-between items-center">
        <button class="{{ com.sentry_trigger() }} {{ com.footer_link_classes() }} cursor-pointer">Is something wrong with this page?</button>
        <a class="{{ com.footer_link_classes() }}" href="#{{ com.back_to_top_id() }}">Back to top</a>
      </div>
      <div class="flex justify-between">
        <div>
          Â© <a class="{{ com.footer_link_classes() }}" href="https://www.bas.ac.uk">British Antarctic Survey</a> (BAS) {{ current_year }}.
          BAS is part of <a class="{{ com.footer_link_classes() }}" href="https://www.ukri.org">UK Research and Innovation</a> (UKRI).
        </div>
        <ul class="flex space-x-2">
          <li><a class="{{ com.footer_link_classes() }}" href="/legal/cookies">Cookies</a></li>
          <li><a class="{{ com.footer_link_classes() }}" href="/legal/copyright">Copyright</a></li>
          <li><a class="{{ com.footer_link_classes() }}" href="/legal/privacy">Privacy</a></li>
        </ul>
      </div>
    </div>
  </footer>
{% endmacro %}
